<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>AI Private Wealth - Live</title>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;900&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}?v={{ range(1, 10000) | random }}">
    <script src="https://unpkg.com/lucide@latest"></script>
    <link rel="manifest" href="{{ url_for('static', filename='manifest.json') }}">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
</head>

<style>
    /* Live Page Specific Overrides */
    body {
        font-family: 'Tajawal', sans-serif !important;
    }

    .screen.l8 {
        padding-bottom: 80px;
    }

    /* Space for nav */

    /* Bottom Navigation */
    .bottom-nav {
        position: fixed;
        bottom: 0;
        left: 0;
        width: 100%;
        background: rgba(15, 23, 42, 0.95);
        backdrop-filter: blur(10px);
        border-top: 1px solid var(--border-color);
        display: flex;
        justify-content: space-around;
        padding: 10px 0 20px 0;
        z-index: 1000;
    }

    .nav-item {
        background: none;
        border: none;
        color: var(--text-muted);
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 5px;
        font-size: 0.7rem;
        cursor: pointer;
    }

    .nav-item.active {
        color: var(--accent-gold);
    }

    .nav-item i {
        width: 20px;
        height: 20px;
    }
</style>

<body class="bank-theme app-mode">

    <!-- Video Background -->
    <div class="video-bg">
        <video autoplay muted loop playsinline id="bg-video">
            <!-- You can swap this URL with any cyber/abstract background -->
            <source
                src="https://assets.mixkit.co/videos/preview/mixkit-digital-animation-of-a-futuristic-city-interface-12977-large.mp4"
                type="video/mp4">
        </video>
        <div style="position:absolute; top:0; left:0; width:100%; height:100%; background:rgba(2, 6, 23, 0.85);"></div>
    </div>

    <!-- Main Screen Layout 8 -->
    <div class="screen l8">

        <!-- 1. Headline -->
        <div class="headline-main">Ø´Ø§Ù‡Ø¯ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ ÙŠØªØ¯Ø§ÙˆÙ„ ÙÙŠ Ø§Ù„Ø³ÙˆÙ‚ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠ ğŸ‡¸ğŸ‡¦</div>
        <div class="sub-ticker">
            <span>Ù†Ø¸Ø§Ù… Ø°ÙƒÙŠ - ØµÙÙ‚Ø§Øª Ø±Ø§Ø¨Ø­Ø© - Ø§Ù„Ø±Ø§Ø¨Ø· ÙÙŠ Ø§Ù„Ø¨Ø§ÙŠÙˆ Ù„Ø§Ù†Ø¶Ù…Ø§Ù… ÙÙˆØ±ÙŠ - ØªØ§Ø¨Ø¹ Ø§Ù„Ø¨Ø« Ø§Ù„Ù…Ø¨Ø§Ø´Ø± - Ø§Ø±Ø¨Ø­ Ù…Ø¹ Ø§Ù„Ù†Ø®Ø¨Ø©</span>
        </div>

        <!-- 2. Header Row -->
        <div class="header-row">
            <span class="live-badge">Ù…Ø¨Ø§Ø´Ø± ğŸ”´</span>
            <span class="timer-badge" id="campaign-timer">00:00:00</span>
            <!-- Bottom Navigation (Native Feel) -->
            <nav class="bottom-nav">
                <button class="nav-item" onclick="window.location.href='/mobile'">
                    <i data-lucide="home"></i>
                    <span>Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span>
                </button>
                <button class="nav-item" onclick="window.location.href='/mobile'">
                    <i data-lucide="grid"></i>
                    <span>Ø§Ù„Ø³ÙˆÙ‚</span>
                </button>
                <button class="nav-item" onclick="window.location.href='/mobile'">
                    <i data-lucide="pie-chart"></i>
                    <span>Ù…Ø­ÙØ¸ØªÙŠ</span>
                </button>
                <button class="nav-item active">
                    <i data-lucide="tv"></i>
                    <span>Ù…Ø¨Ø§Ø´Ø±</span>
                </button>
            </nav>
        </div>

        <!-- 3. Active Bot Card (Data Dense) -->
        <div class="active-bot-card">
            <div>
                <div style="color:var(--accent-gold); font-weight:bold; font-size:1.1rem;" id="active-bot-name">--</div>
                <div class="hero-label">Ø§Ù„Ø¨ÙˆØª Ø§Ù„Ù†Ø´Ø·</div>
                <div style="font-size:0.7rem; color:#cbd5e1; margin-top:4px;">
                    ğŸ¯ Ø¯Ù‚Ø©: <span id="active-bot-accuracy" class="gold">--%</span> |
                    ğŸ’° Ø±ØµÙŠØ¯: <span id="active-bot-balance">--</span>
                </div>
            </div>
            <div style="text-align:left;">
                <div style="font-size:1.8rem; font-weight:bold; direction:ltr;" id="active-bot-return">--%</div>
                <div class="hero-label">Ø§Ù„Ø¹Ø§Ø¦Ø¯ Ø§Ù„ÙŠÙˆÙ…ÙŠ</div>
            </div>
        </div>

        <!-- 4. RACE TRACK FEATURE -->
        <div class="race-track-container">
            <div class="race-header">
                <span>ğŸï¸ Ø³Ø¨Ø§Ù‚ Ø§Ù„Ø¹Ù…Ø§Ù„Ù‚Ø©</span>
                <span>Ø§Ù„Ù‡Ø¯Ù: 20%</span>
            </div>
            <div class="race-lines" id="race-track">
                <!-- Racers will be injected here via JS -->
            </div>
        </div>

        <!-- 5. Dual Leaderboard -->
        <div class="leaderboard-container">
            <div class="leader-card">
                <div class="leader-title">ğŸ‘‘ Ø§Ù„Ø£ÙƒØ«Ø± Ø±Ø¨Ø­Ø§Ù‹</div>
                <div class="leader-val" id="top-profit-bot">--</div>
            </div>
            <div class="leader-card">
                <div class="leader-title">ğŸ¯ Ø§Ù„Ø£Ø¯Ù‚ ØµÙÙ‚Ø©</div>
                <div class="leader-val" id="top-accuracy-bot">--</div>
            </div>
        </div>

        <!-- 6. Roster Ticker -->
        <div class="roster-ticker">
            <span class="roster-label">Ø¨Ù‚ÙŠØ© Ø§Ù„Ø³ÙˆÙ‚: </span>
            <span class="roster-content" id="roster-content">
                <!-- Ticker items injected here -->
            </span>
        </div>

        <!-- 7. Events Log -->
        <div class="events-log" id="events-log">
            <div class="log-item">-- Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙˆÙ‚ --</div>
        </div>

    </div>

    <!-- JavaScript Logic -->
    <script>
        lucide.createIcons();

        // --- Timer Logic ---
        function updateTimer() {
            const now = new Date();
            const end = new Date();
            end.setHours(23, 59, 59);
            const diff = end - now;

            const h = Math.floor(diff / (1000 * 60 * 60));
            const m = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            const s = Math.floor((diff % (1000 * 60)) / 1000);

            document.getElementById('campaign-timer').innerText =
                `${h.toString().padStart(2, '0')}:${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
        }
        setInterval(updateTimer, 1000);

        // --- Data Fetching & UI Update ---
        async function fetchData() {
            try {
                const response = await fetch('/api/live_data');
                const data = await response.json();

                if (data) {
                    updateUI(data);
                }
            } catch (err) {
                console.error("API Error:", err);
            }
        }

        function updateUI(data) {
            const leaders = data.leaderboard || [];

            if (leaders.length > 0) {
                // 1. Update Active Bot (Show #1 or rotate)
                // For simplicity, let's show the #1 bot as Active, or Cycle them?
                // Users usually like to see the Winner. Let's show Rank 1.
                const topBot = leaders[0];
                document.getElementById('active-bot-name').innerText = topBot.name;

                // Simulate Accuracy based on return (for demo/visuals)
                const acc = Math.min(99, 85 + (topBot.return * 2));
                document.getElementById('active-bot-accuracy').innerText = acc.toFixed(1) + '%';

                // Colorize Return
                const retEl = document.getElementById('active-bot-return');
                retEl.innerText = (topBot.return > 0 ? '+' : '') + topBot.return.toFixed(2) + '%';
                retEl.style.color = topBot.return >= 0 ? 'var(--accent-green)' : 'var(--accent-red)';

                // Balance (mock or real if available)
                document.getElementById('active-bot-balance').innerText = (10000 + (topBot.return * 100)).toLocaleString();

                // 2. Update Race Track
                updateRaceTrack(leaders);

                // 3. Update Leaderboard Cards
                // Top Profit = Rank 1
                document.getElementById('top-profit-bot').innerHTML =
                    `<span class="green">${topBot.name} ${topBot.return.toFixed(1)}%</span>`;

                // Top Accuracy (Mock logic: usually bot with small steady gains)
                // Let's pick Rank 2 as "Accurate" for variety if exists
                const accBot = leaders.length > 1 ? leaders[1] : leaders[0];
                document.getElementById('top-accuracy-bot').innerHTML =
                    `<span class="gold">${accBot.name} 95%</span>`;

                // 4. Update Ticker (Rest of bots)
                let tickerHtml = '';
                leaders.slice(2).forEach((bot, i) => {
                    const colorClass = bot.return >= 0 ? 'roster-up' : 'roster-down';
                    tickerHtml += `<span class="roster-item">#${i + 3} ${bot.name} <b class="${colorClass}">${bot.return.toFixed(1)}%</b></span>`;
                });
                document.getElementById('roster-content').innerHTML = tickerHtml;
            }

            // 5. Update Events Log
            if (data.recent_trades && data.recent_trades.length > 0) {
                const logContainer = document.getElementById('events-log');
                logContainer.innerHTML = ''; // Clear old
                data.recent_trades.slice(0, 5).forEach(trade => {
                    const div = document.createElement('div');
                    div.className = 'log-item';
                    const color = trade.action === 'BUY' ? 'green' : 'red';
                    // Example: > Ø´Ø±Ø§Ø¡ Ø£Ø±Ø§Ù…ÙƒÙˆ 32.50
                    div.innerHTML = `> <span class="${color}">${trade.action === 'BUY' ? 'Ø´Ø±Ø§Ø¡' : 'Ø¨ÙŠØ¹'}</span> ${trade.symbol} <span style="float:left">${trade.price}</span>`;
                    logContainer.appendChild(div);
                });
            }
        }

        function updateRaceTrack(leaders) {
            const track = document.getElementById('race-track');
            track.innerHTML = ''; // Re-render

            // We need a finish line concept. Let's say 20% return is the finish line.
            const TARGET_RETURN = 20;
            const trackWidth = track.clientWidth || 300; // Fallback width

            // Add Finish Line Visual
            track.innerHTML += `<div class="finish-line"></div><div class="finish-label">Target</div>`;

            leaders.slice(0, 4).forEach((bot, index) => {
                // Determine Left Position %
                // Map return -5% to 20% -> 0% to 90% (keep room for icon)
                let pct = (bot.return / TARGET_RETURN) * 85;
                if (pct < 0) pct = 0;
                if (pct > 90) pct = 90;

                const botEl = document.createElement('div');
                botEl.className = 'bot-racer';
                botEl.style.left = pct + '%';

                let iconContent = index + 1; // Rank
                let borderColor = 'var(--text-muted)';
                let zIndex = 10 - index;

                if (index === 0) { borderColor = 'var(--accent-green)'; iconContent = 'ğŸ¥‡'; }
                if (index === 1) { borderColor = 'var(--accent-gold)'; iconContent = 'ğŸ¥ˆ'; }
                if (index === 2) { borderColor = '#f97316'; iconContent = 'ğŸ¥‰'; }

                botEl.innerHTML = `
                    <div class="racer-icon" style="border-color:${borderColor}; z-index:${zIndex};">${iconContent}</div>
                    <div class="racer-name">${bot.name}</div>
                `;
                track.appendChild(botEl);
            });
        }

        // Init
        setInterval(fetchData, 2000);
        fetchData();

    </script>
</body>

</html>